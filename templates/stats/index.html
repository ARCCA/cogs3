<!-- templates/dashboard.html -->
{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% block title %}{% trans "Data Analytics" %}{% endblock %}
{% block content %}
<div class="row no-gutters pb-3">
    <div class="col">
        <div class="card">
            <h6 class="card-header border-bottom"><b>{% trans "Data Analytics" %}</b></h6>
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col">
                        <div class="btn-group">
                            <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                                scw0001
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="#">scw0002</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row no-gutters pt-4">
                    <div class="col">
                        <h6>ILorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt
                            ut labore et dolore magna aliqua.</h6>
                    </div>
                </div>
                <div class="row no-gutters pt-3">
                    <div class="col">
                        <nav>
                            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                                <a class="nav-item nav-link active" id="overview-tab" data-toggle="tab" href="#overview"
                                    role="tab" aria-controls="overview" aria-selected="true">Overview</a>
                                <a class="nav-item nav-link" id="nav-compute-tab" data-toggle="tab" href="#nav-compute"
                                    role="tab" aria-controls="nav-compute" aria-selected="false">Compute</a>
                                <a class="nav-item nav-link" id="nav-storage-tab" data-toggle="tab" href="#nav-storage"
                                    role="tab" aria-controls="nav-storage" aria-selected="false">Storage</a>
                            </div>
                        </nav>
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="overview" role="tabpanel"
                                aria-labelledby="overview-tab">
                                {% include 'stats/overview.html' %}
                            </div>
                            <div class="tab-pane fade" id="nav-compute" role="tabpanel"
                                aria-labelledby="nav-compute-tab">
                                {% include 'stats/compute.html' %}
                            </div>
                            <div class="tab-pane fade" id="nav-storage" role="tabpanel"
                                aria-labelledby="nav-storage-tab">
                                {% include 'stats/storage.html' %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block custom_js %}
<script>
    ///////////////////////////////////////////////////////////////////////////
    // Build pi projects chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('pi_projects_chart', {
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'pie'
        },
        title: {
            text: "Principal Investigor's Projects",
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        series: [{
            type: 'pie',
            keys: ['name', 'y', 'selected', 'sliced'],
            data: [
                ['Active', 5, false],
                ['Dormant', 2, false],
                ['Inactive', 1, false],
                ['Retired', 1, false],
            ],
        }],
        exporting: {
            csv: {
                dateFormat: '%Y-%m-%d'
            }
        }
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build project users ts chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('project_users_chart', {
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'pie'
        },
        title: {
            text: "Users status",
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        series: [{
            type: 'pie',
            keys: ['name', 'y', 'selected', 'sliced'],
            data: [
                ['Active', 10, false],
                ['Dormant', 1, false],
                ['Inactive', 3, false],
            ],
        }],
        exporting: {
            csv: {
                dateFormat: '%Y-%m-%d'
            }
        }
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build rate of usage chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('rate_of_usage_chart', {
        title: {
            text: 'CPU, Wait and Wall Time (Rate of usage)',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        yAxis: {
            title: {
                text: 'Unit?'
            }
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
            title: {
                text: 'Month'
            }
        },
        series: [{
            name: 'CPU Time',
            data: [43934, 52503, 57177, 97031, 137133, 69658, 154175, 119931]
        }, {
            name: 'Wait TIme',
            data: [24916, 24064, 29742, 29851, 32490, 30282, 38121, 40434]
        }, {
            name: 'Wall Time',
            data: [11744, 17722, 16005, 19771, 20185, 24377, 32147, 39387]
        },],
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build cumlative usage chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('cumlative_usage_chart', {
        title: {
            text: 'CPU, Wait and Wall Time (Cumlative)',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        yAxis: {
            title: {
                text: 'Unit?'
            }
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
            title: {
                text: 'Month'
            }
        },
        series: [{
            name: 'CPU Time',
            data: [43934, 52503, 57177, 69658, 97031, 119931, 137133, 154175]
        }, {
            name: 'Wait TIme',
            data: [24064, 24916, 29742, 29851, 30282, 32490, 38121, 40434]
        }, {
            name: 'Wall Time',
            data: [11744, 16005, 17722, 19771, 20185, 24377, 32147, 39387]
        },],
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build user usage chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('user_usage_chart', {
        chart: {
            type: 'column'
        },
        title: {
            text: 'Individual User Usage',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        xAxis: {
            categories: ['Aaron', 'Ade', 'Tom', 'Rob', 'Steff']
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Unit?'
            },
            stackLabels: {
                enabled: true,
                style: {
                    fontWeight: 'bold',
                    color: ( // theme
                        Highcharts.defaultOptions.title.style &&
                        Highcharts.defaultOptions.title.style.color
                    ) || 'gray'
                }
            }
        },
        tooltip: {
            headerFormat: '<b>{point.x}</b><br/>',
            pointFormat: '{series.name}: {point.y}<br/>Total: {point.stackTotal}'
        },
        plotOptions: {
            column: {
                stacking: 'normal',
                dataLabels: {
                    enabled: true
                }
            }
        },
        series: [{
            name: 'CPU Time',
            data: [43934, 52503, 57177, 69658, 97031]
        }, {
            name: 'Wait Time',
            data: [24064, 24916, 29742, 29851, 30282]
        }, {
            name: 'Wall Time',
            data: [11744, 16005, 17722, 19771, 20185]
        }]
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build usage by partition chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('usage_by_partition_chart', {
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: null,
            plotShadow: false,
            type: 'pie'
        },
        title: {
            text: 'Usage by partition',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        accessibility: {
            point: {
                valueSuffix: '%'
            }
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: false
                },
                showInLegend: true
            }
        },
        series: [{
            name: 'Paritions',
            colorByPoint: true,
            data: [{
                name: 'CF-compute',
                y: 50,
                sliced: true,
                selected: true
            }, {
                name: 'SW-gpu',
                y: 10
            }, {
                name: 'SW-compute',
                y: 10
            }, {
                name: 'CF-gpu_v100',
                y: 10
            }, {
                name: 'CF-htc',
                y: 10
            },
            {
                name: 'CF-xhtc',
                y: 10
            }]
        }],
        exporting: {
            csv: {
                dateFormat: '%Y-%m-%d'
            }
        }
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build efficiency chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('compute_efficency_chart', {
        chart: {
            type: 'spline',
        },
        title: {
            text: 'Efficency',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        xAxis: {
            type: 'datetime',
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
        },
        yAxis: {
            title: {
                text: 'Efficency'
            },
            max: 100,
            minorGridLineWidth: 0,
            gridLineWidth: 0,
            alternateGridColor: null,
            plotBands: [{
                from: 0,
                to: 40,
                color: 'rgba(68, 170, 213, 0.1)',
                label: {
                    text: 'Poor',
                    style: {
                        color: '#606060'
                    }
                }
            }, {
                from: 40,
                to: 50,
                color: 'rgba(0, 0, 0, 0)',
                label: {
                    text: 'Fair',
                    style: {
                        color: '#606060'
                    }
                }
            }, {
                from: 50,
                to: 75,
                color: 'rgba(68, 170, 213, 0.1)',
                label: {
                    text: 'Good',
                    style: {
                        color: '#606060'
                    }
                }
            }, {
                from: 75,
                to: 100,
                color: 'rgba(0, 0, 0, 0)',
                label: {
                    text: 'Excellent',
                    style: {
                        color: '#606060'
                    }
                }
            }]
        },
        series: [{
            name: 'Efficency',
            data: [
                10, 20, 30, 40, 50, 60, 70
            ]
        }],
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build core count and node utilisation chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('number_of_processors_chart', {
        title: {
            text: 'Core count and node utilisation',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May']
        },
        series: [{
            type: 'column',
            name: 'Total cores',
            data: [3, 2, 1, 3, 4]
        }, {
            type: 'spline',
            name: 'Average cores per job',
            data: [1.5, 1, .5, 1, 2.2],
            marker: {
                lineWidth: 2,
                lineColor: Highcharts.getOptions().colors[3],
                fillColor: 'white'
            }
        },],
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build jobs chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('per_job_average_chart', {
        title: {
            text: 'Per-Job average stats',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May']
        },
        series: [{
            type: 'column',
            name: 'CPU Time',
            data: [3, 2, 1, 3, 4]
        }, {
            type: 'column',
            name: 'Wait Time',
            data: [2, 3, 5, 7, 6]
        }, {
            type: 'column',
            name: 'Wall Time',
            data: [2, 3, 5, 7, 6]
        }],
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build number or slurm jobs chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('num_slurm_jobs_chart', {
        title: {
            text: 'Number of jobs per month',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May']
        },
        series: [{
            type: 'column',
            name: 'Number of Jobs',
            data: [3, 2, 1, 3, 4]
        }],
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build disk space storage chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('disk_space_storage_chart', {
        title: {
            text: 'Disk Space',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May']
        },
        series: [{
            type: 'column',
            name: 'Home',
            data: [3, 2, 1, 3, 4]
        }, {
            type: 'column',
            name: 'Scratch',
            data: [2, 3, 5, 7, 6]
        }],
    });

    ///////////////////////////////////////////////////////////////////////////
    // Build file count storage chart
    ///////////////////////////////////////////////////////////////////////////
    Highcharts.chart('file_count_storage_chart', {
        title: {
            text: 'File Count',
            style: {
                color: '#5e6e82F',
                fontSize: '16px',
                fontFamily: 'Lato',
            }
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May']
        },
        series: [{
            type: 'column',
            name: 'Home',
            data: [3, 2, 1, 3, 4]
        }, {
            type: 'column',
            name: 'Scratch',
            data: [2, 3, 5, 7, 6]
        }],
    });

</script>
{% endblock %}