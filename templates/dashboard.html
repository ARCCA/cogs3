<!-- templates/dashboard.html -->
{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% block title %}{% trans "Dashboard" %}{% endblock %}
{% block content %}

<div class="row pb-3">
	<div class="col">
		{% if user.profile.is_approved %}
		<div class="card">
			<h6 class="card-header border-bottom"><b>{% trans "Join a Project" %}</b></h6>
			<div class="card-body">
				{% include 'project/membership/form.html' %}
			</div>
		</div>
		{% endif %}
	</div>
</div>
<div class="row no-gutters pb-3">
	<div class="col-6 pr-3">
		<div class="card h-100">
			<h6 class="card-header border-bottom">
				<b>Account</b>
				{% if user.profile.account_status == user.profile.AWAITING_APPROVAL %}
				<span class="badge badge-danger float-right">{{user.profile.get_account_status_display}}</span>
				{% else %}
				<span class="badge badge-success float-right">{{user.profile.get_account_status_display}}</span>
				{% endif %}
			</h6>
			<div class="card-body p-3 pb-0">
				<div class="row">
					<div class="col">
						<table class="table mb-0 table-borderless">
							<tbody>
								<tr>
									<td style="width: 40%;">
										<b>{% trans "SCW username" %}:</b>
									</td>
									<td style="width: 60%;">
										{% if user.profile.scw_username %}
										{{user.profile.scw_username}}
										{% endif %}
									</td>
								</tr>
								<tr>
									<td>
										<b>{% trans "Identity" %}:</b>
									</td>
									<td>{{user.email}}</td>
								</tr>
								{% if user.profile.hpcw_username %}
								<tr>
									<th>{% trans "HPCW username" %}</th>
									<td>{{user.profile.hpcw_username}}</td>
								</tr>
								{% endif %}
								{% if user.profile.hpcw_email %}
								<tr>
									<th>{% trans "HPCW email" %}</th>
									<td>{{user.profile.hpcw_email}}</td>
								</tr>
								{% endif %}
								{% if user.profile.raven_username %}
								<tr>
									<th>{% trans "Raven username" %}</th>
									<td>{{user.profile.raven_username}}</td>
								</tr>
								{% endif %}
								{% if user.profile.raven_email %}
								<tr>
									<th>{% trans "Raven email" %}</th>
									<td>{{user.profile.raven_email}}</td>
								</tr>
								{% endif %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-6">
		<div class="card h-100">
			<h6 class="card-header border-bottom"><b>{% trans "Project Management" %}</b></h6>
			<div class="card-body p-3 pb-0">
				<div class="row">
					<div class="col">
						<ul class="list-group list-group-flush p-0">
							{% if perms.project.change_projectusermembership %}
							<li class="list-group-item d-flex justify-content-between align-items-center">
								<a
									href="{% url 'project-user-membership-request-list' %}">{% trans "Project User Requests" %}</a>
								<span
									class="badge badge-primary badge-pill float-right">{{ project_user_requests_count }}</span>
							</li>
							{% endif %}
							{% if perms.project.add_project %}
							<li class="list-group-item d-flex justify-content-between align-items-center">
								<a href="{% url 'project-application-list' %}">{% trans "Project Applications" %}</a>
								<span
									class="badge badge-primary badge-pill float-right">{{ project_application_count }}</span>
							</li>
							{% endif %}
							<li class="list-group-item d-flex justify-content-between align-items-center">
								<a href="{% url 'project-membership-list' %}">{% trans "Project Memberships" %}</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% if user.profile.is_approved %}
<div class="row no-gutters">
	<div class="col-4 pr-3">
		<div class="card h-100">
			<h6 class="card-header border-bottom">
				<b>Projects</b>
			</h6>
			<div class="card-body">
				<div class="row">
					<div class="col">
						<figure class="highcharts-figure">
							<div id="compute_efficency_chart"></div>
						</figure>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-4 py-0">
		<div class="card h-100">
			<h6 class="card-header border-bottom">
				<b>Compute</b>
			</h6>
			<div class="card-body">
				<div class="row">
					<div class="col">
						<figure class="highcharts-figure">
							<div id="num_slurm_jobs_chart"></div>
						</figure>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="col-4 pl-3">
		<div class="card h-100">
			<h6 class="card-header border-bottom">
				<b>Storage</b>
			</h6>
			<div class="card-body">
				<div class="row">
					<div class="col">
						<figure class="highcharts-figure">
							<div id="disk_space_storage_chart"></div>
						</figure>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endif %}
{% endblock %}

{% block custom_js %}
<script>
	///////////////////////////////////////////////////////////////////////////
	// Build efficiency chart
	///////////////////////////////////////////////////////////////////////////
	Highcharts.chart('compute_efficency_chart', {
		chart: {
			type: 'spline',
		},
		title: {
			text: 'Efficency',
			style: {
				color: '#5e6e82F',
				fontSize: '16px',
				fontFamily: 'Lato',
			}
		},
		xAxis: {
			type: 'datetime',
			categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
		},
		yAxis: {
			title: {
				text: 'Efficency'
			},
			max: 100,
			minorGridLineWidth: 0,
			gridLineWidth: 0,
			alternateGridColor: null,
			plotBands: [{
				from: 0,
				to: 40,
				color: 'rgba(68, 170, 213, 0.1)',
				label: {
					text: 'Poor',
					style: {
						color: '#606060'
					}
				}
			}, {
				from: 40,
				to: 50,
				color: 'rgba(0, 0, 0, 0)',
				label: {
					text: 'Fair',
					style: {
						color: '#606060'
					}
				}
			}, {
				from: 50,
				to: 75,
				color: 'rgba(68, 170, 213, 0.1)',
				label: {
					text: 'Good',
					style: {
						color: '#606060'
					}
				}
			}, {
				from: 75,
				to: 100,
				color: 'rgba(0, 0, 0, 0)',
				label: {
					text: 'Excellent',
					style: {
						color: '#606060'
					}
				}
			}]
		},
		series: [{
			name: 'Efficency',
			data: [
				10, 20, 30, 40, 50, 60, 70
			]
		}],
	});

	///////////////////////////////////////////////////////////////////////////
	// Build number or slurm jobs chart
	///////////////////////////////////////////////////////////////////////////
	Highcharts.chart('num_slurm_jobs_chart', {
		title: {
			text: 'Number of jobs per month',
			style: {
				color: '#5e6e82F',
				fontSize: '16px',
				fontFamily: 'Lato',
			}
		},
		xAxis: {
			categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May']
		},
		series: [{
			type: 'column',
			name: 'Number of Jobs',
			data: [3, 2, 1, 3, 4]
		}],
	});

	///////////////////////////////////////////////////////////////////////////
	// Build disk space storage chart
	///////////////////////////////////////////////////////////////////////////
	Highcharts.chart('disk_space_storage_chart', {
		title: {
			text: 'Disk Space',
			style: {
				color: '#5e6e82F',
				fontSize: '16px',
				fontFamily: 'Lato',
			}
		},
		xAxis: {
			categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May']
		},
		series: [{
			type: 'column',
			name: 'Home',
			data: [3, 2, 1, 3, 4]
		}, {
			type: 'column',
			name: 'Scratch',
			data: [2, 3, 5, 7, 6]
		}],
	});

</script>
{% endblock %}